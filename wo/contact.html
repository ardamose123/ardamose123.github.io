<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="semantic/dist/semantic.css" charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.js" charset="utf-8"></script>
    <script src="semantic/dist/semantic.js" charset="utf-8"></script>
    <script src="js/eseecard.js" charset="utf-8"></script>
    <title>Wö</title>
    <style>
      html, body {
        height: auto;
      }
      main {
        margin-top: 2.8em;
        margin-bottom: 3.8em;
        padding: 1em;
      }
      i.icon.hash:before {
        content: "\f292";
      }
    </style>
    <script type="text/javascript">
      function saveContact()
      {
        $('#saveButton').addClass('loading');

        modifyCategories(function(categories) {
          $('#categories').dropdown('get value').split(',').forEach(function(category) {
            categories[category] = { name : category, id : category };
          });
          return categories;
        });

        modifyHashtags(function(hashtags) {
          $('#hashtags').dropdown('get value').split(',').forEach(function(hashtag) {
            hashtags[hashtag] = { name : hashtag, id : hashtag };
          });
          return hashtags;
        });

        updateContact({
          id         : $('#contact-id').val(),
          name       : $('#name'      ).val(),
          location   : $('#location'  ).val(),
          position   : $('#position'  ).val(),
          company    : $('#company'   ).val(),
          phone      : $('#phone'     ).val(),
          email      : $('#email'     ).val(),
          categories : $('#categories').dropdown('get value'),
          hashtags   : $('#hashtags').dropdown('get value')
        });

        $('#contact-title').html($('#name').val());
        $('#saveButton').removeClass('loading');
      }

      var dropdownOptions = {
        allowAdditions: true,
        saveRemoteData: false,
        direction: 'upward',
        message: {
          addResult     : 'Crear categoría <strong>{term}</strong>',
          count         : '{count} seleccionados',
          maxSelections : '{maxCount} selecciones como máximo',
          noResults     : 'No se encontró resultados de búsqueda.'
        }
      };

      var hashtagOptions = dropdownOptions;
      hashtagOptions.message.addResult = 'Crear hashtag <strong>{term}</strong>';

      $(document).ready(function() {
        var contact = listContacts()[getURLParameter('key')];

        $('#contact-id').val(contact.id      );
        $('#name'      ).val(contact.name    );
        $('#location'  ).val(contact.location);
        $('#position'  ).val(contact.position);
        $('#company'   ).val(contact.company );
        $('#phone'     ).val(contact.phone   );
        $('#email'     ).val(contact.email   );
        $('#contact-title').html(contact.name);

        $('#categories').dropdown(dropdownOptions);
        $('#hashtags'  ).dropdown(dropdownOptions);

        $('.ui.form').form({
          fields: {
            name : 'empty',
            email: 'email'
          },
          prompt: {
            empty : 'Escribe algo en este campo.',
            email : 'Escribe una dirección de correo electrónico correcta.'
          },
          inline: true,
          onSuccess: saveContact
        });

        $('#categories').dropdown('set selected', contact.categories.split(','));
        $('#hashtags').dropdown('set selected', contact.hashtags.split(','));
      });
    </script>
  </head>
  <body>
    <div class="ui inverted blue top fixed borderless menu">
      <div class="item" onclick="window.location = 'contact-list.html'"><i class="ui arrow left icon"></i></div>
      <div class="item" id="contact-title"></div>
    </div>
    <main>
      <form class="ui form">
        <input type="hidden" id="contact-id">
        <div class="field">
          <label><i class="user icon"></i> Nombre</label>
          <input type="text" id="name" placeholder="Nombre">
        </div>
        <div class="field">
          <label><i class="marker icon"></i> Ubicación</label>
          <input type="text" id="location">
        </div>
        <div class="field">
          <label><i class="travel icon"></i> Puesto o rol</label>
          <input type="text" id="position">
        </div>
        <div class="field">
          <label><i class="building icon"></i> Empresa</label>
          <input type="text" id="company">
        </div>
        <h4 class="ui orange horizontal divider header">Contacto</h4>
        <div class="field">
          <label><i class="phone icon"></i> Número de teléfono</label>
          <input type="tel" id="phone">
        </div>
        <div class="field">
          <label><i class="mail icon"></i> Correo electrónico</label>
          <input type="email" id="email">
        </div>
        <h4 class="ui orange horizontal divider header">Otros datos</h4>
        <div class="field">
          <label><i class="tags icon"></i> Categorías</label>
          <script>
            document.write(renderCategoryDropdown('categories', 'categories'));
            $('#categories').dropdown(dropdownOptions);
          </script>
        </div>
        <div class="field">
          <label><i class="hash icon"></i> Hashtags</label>
          <script>
            document.write(renderHashtagsDropdown('hashtags', 'hashtags'));
            $('#hashtags').dropdown(hashtagOptions);
          </script>
        </div>
      </form>
    </main>
    <div class="ui bottom fixed borderless menu">
      <div class="right menu">
        <div class="item">
          <button class="ui compact button" id="saveButton" onclick="saveContact();" style="margin-right: 0.5em;"><i class="ui download icon"></i> Guardar</button>
          <button class="ui primary compact button" onclick="window.location = 'card-page.html;"><i class="ui browser icon"></i> Ver tarjeta</button>
        </div>
      </div>
    </div>
  </body>
</html>
